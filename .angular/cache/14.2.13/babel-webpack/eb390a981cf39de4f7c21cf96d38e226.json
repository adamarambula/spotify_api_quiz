{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/adamj/Documents/fast_track_online_training/github_assignments/angular-whos-who-feb-2024-team-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nimport { request } from \"../../services/api\";\nconst AUTH_ENDPOINT = \"https://nuod0t2zoe.execute-api.us-east-2.amazonaws.com/FT-Classroom/spotify-auth-token\";\nconst TOKEN_KEY = \"whos-who-access-token\";\nlet HomeComponent = class HomeComponent {\n  constructor() {\n    var _this = this;\n\n    this.genres = [\"House\", \"Alternative\", \"J-Rock\", \"R&B\"];\n    this.selectedGenre = \"\";\n    this.authLoading = false;\n    this.configLoading = false;\n    this.token = \"\";\n\n    this.loadGenres = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (t) {\n        _this.configLoading = true; // #################################################################################\n        // DEPRECATED!!! Use only for example purposes\n        // DO NOT USE the recommendations endpoint in your application\n        // Has been known to cause 429 errors\n        // const response = await fetchFromSpotify({\n        //   token: t,\n        //   endpoint: \"recommendations/available-genre-seeds\",\n        // });\n        // console.log(response);\n        // #################################################################################\n\n        _this.genres = [\"rock\", \"rap\", \"pop\", \"country\", \"hip-hop\", \"jazz\", \"alternative\", \"j-pop\", \"k-pop\", \"emo\"];\n        _this.configLoading = false;\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  }\n\n  ngOnInit() {\n    this.authLoading = true;\n    const storedTokenString = localStorage.getItem(TOKEN_KEY);\n\n    if (storedTokenString) {\n      const storedToken = JSON.parse(storedTokenString);\n\n      if (storedToken.expiration > Date.now()) {\n        console.log(\"Token found in localstorage\");\n        this.authLoading = false;\n        this.token = storedToken.value;\n        this.loadGenres(storedToken.value);\n        return;\n      }\n    }\n\n    console.log(\"Sending request to AWS endpoint\");\n    request(AUTH_ENDPOINT).then(({\n      access_token,\n      expires_in\n    }) => {\n      const newToken = {\n        value: access_token,\n        expiration: Date.now() + (expires_in - 20) * 1000\n      };\n      localStorage.setItem(TOKEN_KEY, JSON.stringify(newToken));\n      this.authLoading = false;\n      this.token = newToken.value;\n      this.loadGenres(newToken.value);\n    });\n  }\n\n  setGenre(selectedGenre) {\n    this.selectedGenre = selectedGenre;\n    console.log(this.selectedGenre);\n    console.log(TOKEN_KEY);\n  }\n\n};\nHomeComponent = __decorate([Component({\n  selector: \"app-home\",\n  templateUrl: \"./home.component.html\",\n  styleUrls: [\"./home.component.css\"]\n})], HomeComponent);\nexport { HomeComponent };","map":{"version":3,"mappings":";;AAAA,SAASA,SAAT,QAAkC,eAAlC;AACA,SAA2BC,OAA3B,QAA0C,oBAA1C;AAEA,MAAMC,aAAa,GACjB,wFADF;AAEA,MAAMC,SAAS,GAAG,uBAAlB;AAOA,IAAaC,aAAa,GAA1B,MAAaA,aAAb,CAA0B;EACxBC;IAAA;;IAEA,cAAmB,CAAC,OAAD,EAAU,aAAV,EAAyB,QAAzB,EAAmC,KAAnC,CAAnB;IACA,qBAAwB,EAAxB;IACA,mBAAuB,KAAvB;IACA,qBAAyB,KAAzB;IACA,aAAgB,EAAhB;;IA4BA;MAAA,6BAAa,WAAOC,CAAP,EAAiB;QAC5B,KAAI,CAACC,aAAL,GAAqB,IAArB,CAD4B,CAG5B;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA,KAAI,CAACC,MAAL,GAAc,CACZ,MADY,EAEZ,KAFY,EAGZ,KAHY,EAIZ,SAJY,EAKZ,SALY,EAMZ,MANY,EAOZ,aAPY,EAQZ,OARY,EASZ,OATY,EAUZ,KAVY,CAAd;QAYA,KAAI,CAACD,aAAL,GAAqB,KAArB;MACD,CA3BD;;MAAA;QAAA;MAAA;IAAA;EAlCgB;;EAQhBE,QAAQ;IACN,KAAKC,WAAL,GAAmB,IAAnB;IACA,MAAMC,iBAAiB,GAAGC,YAAY,CAACC,OAAb,CAAqBV,SAArB,CAA1B;;IACA,IAAIQ,iBAAJ,EAAuB;MACrB,MAAMG,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWL,iBAAX,CAApB;;MACA,IAAIG,WAAW,CAACG,UAAZ,GAAyBC,IAAI,CAACC,GAAL,EAA7B,EAAyC;QACvCC,OAAO,CAACC,GAAR,CAAY,6BAAZ;QACA,KAAKX,WAAL,GAAmB,KAAnB;QACA,KAAKY,KAAL,GAAaR,WAAW,CAACS,KAAzB;QACA,KAAKC,UAAL,CAAgBV,WAAW,CAACS,KAA5B;QACA;MACD;IACF;;IACDH,OAAO,CAACC,GAAR,CAAY,iCAAZ;IACApB,OAAO,CAACC,aAAD,CAAP,CAAuBuB,IAAvB,CAA4B,CAAC;MAAEC,YAAF;MAAgBC;IAAhB,CAAD,KAAiC;MAC3D,MAAMC,QAAQ,GAAG;QACfL,KAAK,EAAEG,YADQ;QAEfT,UAAU,EAAEC,IAAI,CAACC,GAAL,KAAa,CAACQ,UAAU,GAAG,EAAd,IAAoB;MAF9B,CAAjB;MAIAf,YAAY,CAACiB,OAAb,CAAqB1B,SAArB,EAAgCY,IAAI,CAACe,SAAL,CAAeF,QAAf,CAAhC;MACA,KAAKlB,WAAL,GAAmB,KAAnB;MACA,KAAKY,KAAL,GAAaM,QAAQ,CAACL,KAAtB;MACA,KAAKC,UAAL,CAAgBI,QAAQ,CAACL,KAAzB;IACD,CATD;EAUD;;EA+BDQ,QAAQ,CAACC,aAAD,EAAmB;IACzB,KAAKA,aAAL,GAAqBA,aAArB;IACAZ,OAAO,CAACC,GAAR,CAAY,KAAKW,aAAjB;IACAZ,OAAO,CAACC,GAAR,CAAYlB,SAAZ;EACD;;AApEuB,CAA1B;AAAaC,aAAa,eALzBJ,SAAS,CAAC;EACTiC,QAAQ,EAAE,UADD;EAETC,WAAW,EAAE,uBAFJ;EAGTC,SAAS,EAAE,CAAC,sBAAD;AAHF,CAAD,CAKgB,GAAb/B,aAAa,CAAb;SAAAA","names":["Component","request","AUTH_ENDPOINT","TOKEN_KEY","HomeComponent","constructor","t","configLoading","genres","ngOnInit","authLoading","storedTokenString","localStorage","getItem","storedToken","JSON","parse","expiration","Date","now","console","log","token","value","loadGenres","then","access_token","expires_in","newToken","setItem","stringify","setGenre","selectedGenre","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["C:\\Users\\adamj\\Documents\\fast_track_online_training\\github_assignments\\angular-whos-who-feb-2024-team-1\\src\\app\\home\\home.component.ts"],"sourcesContent":["import { Component, OnInit } from \"@angular/core\";\r\nimport fetchFromSpotify, { request } from \"../../services/api\";\r\n\r\nconst AUTH_ENDPOINT =\r\n  \"https://nuod0t2zoe.execute-api.us-east-2.amazonaws.com/FT-Classroom/spotify-auth-token\";\r\nconst TOKEN_KEY = \"whos-who-access-token\";\r\n\r\n@Component({\r\n  selector: \"app-home\",\r\n  templateUrl: \"./home.component.html\",\r\n  styleUrls: [\"./home.component.css\"],\r\n})\r\nexport class HomeComponent implements OnInit {\r\n  constructor() {}\r\n\r\n  genres: String[] = [\"House\", \"Alternative\", \"J-Rock\", \"R&B\"];\r\n  selectedGenre: String = \"\";\r\n  authLoading: boolean = false;\r\n  configLoading: boolean = false;\r\n  token: String = \"\";\r\n\r\n  ngOnInit(): void {\r\n    this.authLoading = true;\r\n    const storedTokenString = localStorage.getItem(TOKEN_KEY);\r\n    if (storedTokenString) {\r\n      const storedToken = JSON.parse(storedTokenString);\r\n      if (storedToken.expiration > Date.now()) {\r\n        console.log(\"Token found in localstorage\");\r\n        this.authLoading = false;\r\n        this.token = storedToken.value;\r\n        this.loadGenres(storedToken.value);\r\n        return;\r\n      }\r\n    }\r\n    console.log(\"Sending request to AWS endpoint\");\r\n    request(AUTH_ENDPOINT).then(({ access_token, expires_in }) => {\r\n      const newToken = {\r\n        value: access_token,\r\n        expiration: Date.now() + (expires_in - 20) * 1000,\r\n      };\r\n      localStorage.setItem(TOKEN_KEY, JSON.stringify(newToken));\r\n      this.authLoading = false;\r\n      this.token = newToken.value;\r\n      this.loadGenres(newToken.value);\r\n    });\r\n  }\r\n\r\n  loadGenres = async (t: any) => {\r\n    this.configLoading = true;\r\n\r\n    // #################################################################################\r\n    // DEPRECATED!!! Use only for example purposes\r\n    // DO NOT USE the recommendations endpoint in your application\r\n    // Has been known to cause 429 errors\r\n    // const response = await fetchFromSpotify({\r\n    //   token: t,\r\n    //   endpoint: \"recommendations/available-genre-seeds\",\r\n    // });\r\n    // console.log(response);\r\n    // #################################################################################\r\n    \r\n    this.genres = [\r\n      \"rock\",\r\n      \"rap\",\r\n      \"pop\",\r\n      \"country\",\r\n      \"hip-hop\",\r\n      \"jazz\",\r\n      \"alternative\",\r\n      \"j-pop\",\r\n      \"k-pop\",\r\n      \"emo\"\r\n    ]\r\n    this.configLoading = false;\r\n  };\r\n\r\n  setGenre(selectedGenre: any) {\r\n    this.selectedGenre = selectedGenre;\r\n    console.log(this.selectedGenre);\r\n    console.log(TOKEN_KEY);\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}